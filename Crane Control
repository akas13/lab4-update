package de.tuhh.diss.harborstorage;

import de.tuhh.diss.harborstorage.sim.PhysicalCrane;
import de.tuhh.diss.harborstorage.sim.StorageElement;


public class CraneControl  {
	private PhysicalCrane CR;
	public CraneControl (PhysicalCrane cr){
		CR = cr;
		// what to set cr to in the constructor
	}
	public void storePacket(int x, int y, StorageElement packet) {
		CR.loadElement(packet);
		moveToX(x);
		moveToY(y);
		CR.storeElement();
		x = CR.getLoadingPosX();
		y = CR.getLoadingPosY();
		moveToX(x);
		moveToY(y);
		// : Add your own code. 
	}
	
	public StorageElement retrievePacket(int x, int y) {
		Packet packet;
		
		moveToX(x);
		moveToY(y);
		packet = null;
		CR.retrieveElement();
		x = CR.getLoadingPosX();
		y = CR.getLoadingPosY();
		moveToX(x);
		moveToY(y);
		CR.unloadElement();
		return packet; // : Replace this with your own code. 
		// TODO How do we return packet without setting its value review this pending our changes in HSM 12/19/16 
	}
	
	public void shutdown() {
		CR.shutdown(); // : Add your own code. 
	}
	private int moveToX(int x) {
		int posx = 0;
		posx = CR.getPositionX();
		while (posx != x){
			if (posx < x){
				CR.forward();
				CR.stopX();
			posx = CR.getPositionX();				//Changed from getLoadingPosX, caused program to think posx wasnt moving
			}
			else if (posx>x){
				CR.backward();
				CR.stopX();
			posx = CR.getPositionX();				//Changed from getLoadingPosX
			}
		}
		return posx; // : Replace this with your own code.
	}
	private int moveToY(int y) {
		int posy = 0;
		posy = CR.getPositionY();
		while (posy != y){
			if (posy < y){
				CR.up();							//Changed to up() since forward() only works for x
				CR.stopY();
				posy=CR.getPositionY();				//Changed from getLoadingPosY
			}
			else if (posy > y){
				CR.down();							//Changed to down() since backward() only works for x
				CR.stopY();
				posy = CR.getPositionY();			//Changed from getLoadingPosY
			}	
		}
		return posy; // : Replace this with your own code.
	
	}}
