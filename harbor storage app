package de.tuhh.diss.harborstorage;

import de.tuhh.diss.harborstorage.sim.StorageException;
import de.tuhh.diss.io.SimpleIO;

public class HarborStorageApp {
	
	private static HarborStorageManagement HSM;
	
	//This method creates an array of the stored packets and prints the information, but only if there are items in it
	private static void showAvaliblePackets() {			
		Packet[] packetArray;
		packetArray = HSM.getPackets();
		if(packetArray.length != 0){
			SimpleIO.print("\nAvailable packets:\n");
			int num = 1;
			for (int i = 0; i < packetArray.length; i++){
			SimpleIO.print(num + ": Packet '" + packetArray[i].getDescription() + "' Size: " + packetArray[i].getWidth() + "x" + packetArray[i].getHeight()
				+ "x"  + packetArray[i].getDepth() + " Weight: " + packetArray[i].getWeight() + "\n");
			num++;
			
			}
		}
	}
	
	//This method makes sure the description entered is not already being used for another packet
	private static String nonRepeatingDescription(){
		String des = nonBlankString();
		boolean notRepeating = false;
		Packet[] packetArray;
		packetArray = HSM.getPackets();
		while (notRepeating == false){
			int count = 0;
			for (int i = 0; i < packetArray.length; i++){
				if (des.compareTo(packetArray[i].getDescription()) == 0){
					SimpleIO.print("I'm sorry, the description you entered is already being used for another packet.\n");
					SimpleIO.print("Please enter a new description and try again.\n");
					des = nonBlankString();
					break;
				} else count++;
			}
			if (count == packetArray.length)
				notRepeating = true;
		}
		return des;
	}
	
	//This method makes sure the description entered is not blank
	private static String nonBlankString(){				
		boolean notBlank = false;
		String des = SimpleIO.readString();
		while (notBlank == false){
			if ( des.compareTo("") != 0)
				notBlank = true;
			else {
				SimpleIO.print("I'm sorry, the description you entered is blank.\n");
				SimpleIO.print("Please enter a description that conatains at least one character.\n");
				des = SimpleIO.readString();
			}
		}
		return des;
	}
	
	//This method makes sure the numbers entered are greater than 0
	private static int realityCheck(){					
		boolean Real = false;
		int num = readInt();
		while (Real == false){
			if (num > 0)
				Real = true;
			else {
				SimpleIO.print("I'm sorry, the number you entered is not realistic.\n");
				SimpleIO.print("Please enter a number greater than 0.\n");
				num = readInt();
			}
		}
		return num;
	}
	
	//This method catches the exception thrown by SimpleIO.readInt when a String is entered.
	//If caught it informs the user of the mistake and asks them to try again.
	private static int readInt(){
		boolean string = true;
		int num = 0;
		while(string == true){
			try{
				num = SimpleIO.readInt();
				string = false;
			} catch (Exception e){
				SimpleIO.print("I'm sorry, you entered something other than a whole number.\n");
				SimpleIO.print("Please enter a number and try again.\n");
			}
		}
		
		
		return num;
	}
	
	public static void main (String[] args)  {
	HSM = new HarborStorageManagement();				
	
	int selection;
		do{
		showAvaliblePackets();							
		SimpleIO.print("\n\n*** Main Menu ***\n");
		SimpleIO.print("1) Store a Packet\n");
		SimpleIO.print("2) Retrieve a packet\n");
		SimpleIO.print("3) Print list of avalible slots\n");
		SimpleIO.print("4) Quit\n");
		selection = readInt();
		switch (selection){
		
		//Case 1 calls the information and methods needed to store a packet
		case 1:
			SimpleIO.print("Please give a description\n");
			String description = nonRepeatingDescription();
			
			SimpleIO.print("Please give the width of the packet\n");
			int wi = realityCheck();
			
			SimpleIO.print("Please give the height of the packet\n");
			int hi = realityCheck();
			
			SimpleIO.print("Please give the depth of the packet\n");
			int de = realityCheck();
			
			SimpleIO.print("Please give the weight of the packet\n");
			int we = realityCheck();
			
			try {
				HSM.storePacket(wi, hi, de, description, we);
			} catch (StorageException e) {
				e.printStackTrace();
			}
			break;
			
		//Case 2 calls the needed methods to retrieve a packet	
		case 2: 
			SimpleIO.print("Please give a description\n");
			String description1 = nonBlankString();
			try {
				HSM.retrievePacket(description1);
			} catch (StorageException e) {
				e.printStackTrace();
			}
			break;
		
		//Case 3 prints the available slots for the user to see, and gives them the additional information of the slot size and load capacity
		case 3:
			HSM.printAvalibleSlots();
			break;
			
		//Case 4 ends the program	
		case 4:
			SimpleIO.print("Goodbye\n");
			break;
		
		}
		
		}while(selection != 4);
		HSM.shutdown();					// shutdown method is called when the while statement is ended 
	}
}
